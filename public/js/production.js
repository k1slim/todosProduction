define("ContentEditable",["react"],function(e){var t=13;return e.createClass({displayName:"ContentEditable",getDefaultProps:function(){return{pencil:!0}},getInitialState:function(){return{isEditing:!1,value:this.props.value}},_onChange:function(t){this.setState({value:t.target.value})},_onKeyPress:function(n){n.which===t&&this._toggle()},_parseValue:function(){var t=/\[(.*)\]\((.*)\)/g;return this.state.value.replace(t,function(e,t,n){return"<a href='"+n+"' target='_blank'>"+t+"</a>"})},_toggle:function(){var t=this.state.isEditing;this.setState({isEditing:!t}),t&&this.props.updateValue(this.state.value)},_chooseImageVersion:function(){return this.props.className==="itemText"?"image/icons/pencil_gray.png":"image/icons/pencil_white.png"},_setEditablePencil:function(){return this.props.pencil?e.createElement("img",{src:this._chooseImageVersion(),alt:"edit",onClick:this._toggle}):""},render:function(){return this.state.isEditing?e.createElement("input",{className:this.props.inputClassName,autoFocus:!0,type:"text",value:this.state.value,onChange:this._onChange,onKeyPress:this._onKeyPress,onBlur:this._toggle}):e.createElement("div",{className:"contentEditableWrapper"},e.createElement("span",{className:this.props.className,onDoubleClick:this._toggle,dangerouslySetInnerHTML:{__html:this._parseValue()}}),this._setEditablePencil())}})}),define("Dispatcher",["flux"],function(e){return new e.Dispatcher}),define("Constants",[],function(){return{TODO_CREATE:"TODO_CREATE",TODO_DELETE:"TODO_DELETE",TODO_UPDATE:"TODO_UPDATE",TODO_TOGGLE:"TODO_TOGGLE",TAB_CREATE:"TAB_CREATE",TAB_UPDATE:"TAB_UPDATE",TAB_SELECT:"TAB_SELECT"}}),define("Actions",["Dispatcher","Constants"],function(e,t){return{createTodo:function(r){e.dispatch({actionType:t.TODO_CREATE,value:r})},deleteTodo:function(r){e.dispatch({actionType:t.TODO_DELETE,id:r})},updateTodo:function(r,i){e.dispatch({actionType:t.TODO_UPDATE,id:r,value:i})},toggleTodo:function(r){e.dispatch({actionType:t.TODO_TOGGLE,id:r})},createTab:function(r){e.dispatch({actionType:t.TAB_CREATE,value:r})},updateTab:function(r,i){e.dispatch({actionType:t.TAB_UPDATE,id:r,value:i})},selectTab:function(r){e.dispatch({actionType:t.TAB_SELECT,id:r})}}}),define("queries",[],function(){function e(e,n,r){return t({type:e.toUpperCase(),data:JSON.stringify(r),headers:{"Content-type":"application/json"},url:n})}function t(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open(e.type,e.url),r.onload=function(){this.status>=200&&this.status<300?t(JSON.parse(r.response)):n({status:this.status,statusText:r.statusText})},r.onerror=function(){n({status:this.status,statusText:r.statusText})},e.headers&&Object.keys(e.headers).forEach(function(t){r.setRequestHeader(t,e.headers[t])}),r.send(e.data)})}return{getTodos:function(n){return e("get","/todos/"+n)},createTodo:function(n){e("post","/todo",n)},deleteTodo:function(n){e("delete","/todo/"+n)},updateTodo:function(n,r){e("put","/todo/"+n,{value:r})},toggleTodo:function(n,r){e("put","/todo/"+n,{done:r})},getTabs:function(n){return e("get","/tabs/"+n)},createTab:function(n){e("post","/tab",n)},deleteTab:function(n){e("delete","/tab/"+n)},updateTab:function(n,r){e("put","/tab/"+n,{value:r})},login:function(n,r,i){return e("post","/login/?session="+i,{username:n,password:r})},logout:function(){e("get","/logout")},getSession:function(){return e("get","/session")}}}),define("Store",["eventEmitter","queries","Dispatcher","Constants"],function(e,t,n,r){function c(e){var n={id:""+Date.now()+~~(Math.random()*100),value:e,tab:a};o.push(n),t.createTodo(n)}function h(e){o=o.filter(function(t){return t.id!==e}),t.deleteTodo(e),v()&&(y(a),b(u[0].id),E(),w(),l.emitTabChange())}function p(e,n){o.forEach(function(t){t.id===e&&(t.value=n)}),t.updateTodo(e,n)}function d(e){var n=!0;o.forEach(function(t){t.id===e&&(n=!t.done,t.done=n)}),t.toggleTodo(e,n)}function v(){return o.length===0}function m(e){var n={id:""+Date.now()+~~(Math.random()*100),value:e,user:f};u.push(n),t.createTab(n),b(n.id),E(),w()}function g(e,n){u.forEach(function(t){t.id===e&&(t.value=n)}),t.updateTab(e,n)}function y(e){u.length>1&&(u=u.filter(function(t){return t.id!==e}),t.deleteTab(e))}function b(e){a=e}function w(){t.getTodos(a).then(function(e){o=e,l.emitTodoChange()})}function E(){localStorage.setItem("selectedTab",a)}function S(){return localStorage.getItem("selectedTab")}var i="CHANGE_TODO_EVENT",s="CHANGE_TAB_EVENT",o=[],u=[],a="",f="",l;return l=Object.assign({},e.prototype,{initializeStore:function(n){t.getTabs(n).then(function(e){f=n,u=e;var t=S();t&&u.some(function(e){return e.id===t})?b(t):(b(u[0].id),E()),w(),l.emitTabChange()})},getTodos:function(){return o},emitTodoChange:function(){this.emit(i)},addTodoChangeListener:function(t){this.on(i,t)},removeTodoChangeListener:function(t){this.removeListener(i,t)},getTabs:function(){return u},emitTabChange:function(){this.emit(s)},addTabChangeListener:function(t){this.on(s,t)},removeTabChangeListener:function(t){this.removeListener(s,t)},getSelected:function(){return a}}),n.register(function(e){var t=0,n=250,i;switch(e.actionType){case r.TODO_CREATE:i=e.value.trim(),i.length>t&&i.length<=n&&(c(i),l.emitTodoChange());break;case r.TODO_DELETE:h(e.id),l.emitTodoChange();break;case r.TODO_UPDATE:p(e.id,e.value),l.emitTodoChange();break;case r.TODO_TOGGLE:d(e.id),l.emitTodoChange();break;case r.TAB_CREATE:i=e.value.trim(),i.length>t&&i.length<=n&&(m(i),l.emitTabChange());break;case r.TAB_UPDATE:g(e.id,e.value),l.emitTabChange();break;case r.TAB_SELECT:b(e.id),E(),w(),l.emitTabChange();break;default:}}),l}),define("NavItem",["react","ContentEditable","Actions","Store"],function(e,t,n,r){return e.createClass({displayName:"NavItem",_onClick:function(){n.selectTab(this.props.id)},_setItemClass:function(){return this.props.id===r.getSelected()?"menuItem selectedMenuItem":"menuItem"},_setPencilProps:function(){return this.props.id===r.getSelected()},_updateValue:function(t){n.updateTab(this.props.id,t)},render:function(){return e.createElement("div",{className:this._setItemClass(),onClick:this._onClick},e.createElement(t,{className:"menuItemText",inputClassName:"contentEditable contentEditableTab",value:this.props.value,updateValue:this._updateValue,pencil:this._setPencilProps()}))}})}),define("Nav",["react","NavItem","Store"],function(e,t,n){function s(e,t){for(var n=0,r=e.length;n<=r;n++)if(e[n].id===t)return n}function o(e,t){var n=t-r/2,i=t+r/2;if(n>=0&&i<=e)return{startIndex:n,endIndex:i};if(n<0)return{startIndex:0,endIndex:r};if(i>e)return{startIndex:e-r,endIndex:e}}function u(e,t,n){var i=t+r,s=t+n,o=i+n;return s>=0&&o<=e?{startIndex:s,endIndex:o}:{startIndex:t,endIndex:i}}var r=6,i=0;return e.createClass({displayName:"Nav",getInitialState:function(){return{items:[],startIndex:0,endIndex:0}},componentDidMount:function(){n.addTabChangeListener(this._updateList)},componentWillUnmount:function(){n.removeTabChangeListener(this._updateList)},_setArrowsClass:function(){return this.state.items.length>r?"arrows showArrows":"arrows"},_onLeftArrowClick:function(){var t=u(this.state.items.length,this.state.startIndex,-1);this.setState({startIndex:t.startIndex,endIndex:t.endIndex})},_onRightArrowClick:function(){var t=u(this.state.items.length,this.state.startIndex,1);this.setState({startIndex:t.startIndex,endIndex:t.endIndex})},_onTouchStart:function(t){i=t.touches[0].clientX},_onTouchMove:function(t){var n=50,r=t.touches[0].clientX;if(r>i+n){i+=n;var s=u(this.state.items.length,this.state.startIndex,-1);this.setState({startIndex:s.startIndex,endIndex:s.endIndex})}if(r<i-n){i-=n;var s=u(this.state.items.length,this.state.startIndex,1);this.setState({startIndex:s.startIndex,endIndex:s.endIndex})}},_updateList:function(){var t=n.getTabs(),i=n.getSelected(),u=t.length;if(u>r){var a=s(t,i),f=o(u,a);this.setState({items:t,startIndex:f.startIndex,endIndex:f.endIndex})}else this.setState({items:t,endIndex:u})},render:function(){return e.createElement("nav",{className:"nav",onTouchMove:this._onTouchMove,onTouchStart:this._onTouchStart},e.createElement("div",{className:this._setArrowsClass(),onClick:this._onLeftArrowClick},e.createElement("img",{src:"image/icons/left.png",alt:"left"})),e.createElement("div",{className:"menu"},this.state.items.slice(this.state.startIndex,this.state.endIndex).map(function(n){return e.createElement(t,{id:n.id,key:n.id,value:n.value})})),e.createElement("div",{className:this._setArrowsClass(),onClick:this._onRightArrowClick},e.createElement("img",{src:"image/icons/right.png",alt:"right"})))}})}),define("LoginStore",["queries","eventEmitter","Store"],function(e,t,n){var r="CHANGE_LOGIN_STATUS_EVENT",i="",s="",o;return o=Object.assign({},t.prototype,{initializeFromSession:function(){var r=this;e.getSession().then(function(e){e!==!1&&(i="Login successful",s=e.username,r.emitLoginChange(),n.initializeStore(e.userId))})},login:function(r,o,u){var a=this;e.login(r,o,u).then(function(e){i=e.status,s=r,a.emitLoginChange(),i==="Login successful"&&n.initializeStore(e.userId)})},logout:function(){i="",this.emitLoginChange(),e.logout()},getLoginStatus:function(){return i},getUserName:function(){return s},emitLoginChange:function(){this.emit(r)},addLoginListener:function(t){this.on(r,t)},removeLoginListener:function(t){this.removeListener(r,t)}}),o}),define("Header",["react","Nav","Actions","LoginStore"],function(e,t,n,r){var i=13;return e.createClass({displayName:"Header",getInitialState:function(){return{value:""}},_onChange:function(t){this.setState({value:t.target.value})},_onClick:function(){r.logout()},_onKeyPress:function(t){t.which===i&&this._addItem()},_addItem:function(){n.createTab(this.state.value),this.setState({value:""})},render:function(){return e.createElement("header",{className:"header"},e.createElement("div",{className:"head"},e.createElement("div",{className:"title"},e.createElement("h1",null,"ToDos")),e.createElement("div",{className:"userField"},e.createElement("span",{className:"usernamePlaceholder"},r.getUserName()),e.createElement("span",{className:"logoutButton",onClick:this._onClick},"LOGOUT")),e.createElement("div",{className:"addTabField"},e.createElement("input",{type:"text",placeholder:"Add new tab",value:this.state.value,onChange:this._onChange,onKeyPress:this._onKeyPress}))),e.createElement(t,null))}})}),define("Item",["react","ContentEditable","Actions"],function(e,t,n){return e.createClass({displayName:"Item",_doneHandler:function(){n.toggleTodo(this.props.id)},_deleteHandler:function(){n.deleteTodo(this.props.id)},_setItemClass:function(){return this.props.done?"item completed":"item"},_updateValue:function(t){n.updateTodo(this.props.id,t)},render:function(){return e.createElement("div",{className:this._setItemClass()},e.createElement("div",{className:"itemDone",onClick:this._doneHandler},e.createElement("img",{src:"image/icons/done.png",alt:"done"})),e.createElement(t,{className:"itemText",inputClassName:"contentEditable",value:this.props.value,updateValue:this._updateValue}),e.createElement("div",{className:"itemDelete",onClick:this._deleteHandler},e.createElement("img",{src:"image/icons/delete.png",alt:"delete"})))}})}),define("Content",["react","Item","Store"],function(e,t,n){return e.createClass({displayName:"Content",getInitialState:function(){return{items:[]}},componentDidMount:function(){n.addTodoChangeListener(this._updateList)},componentWillUnmount:function(){n.removeTodoChangeListener(this._updateList)},_updateList:function(){this.setState({items:n.getTodos()})},render:function(){return e.createElement("div",{className:"content",id:"content"},this.state.items.map(function(n){return e.createElement(t,{id:n.id,key:n.id,value:n.value,done:n.done})}))}})}),define("Footer",["react","Actions"],function(e,t){var n=13;return e.createClass({displayName:"Footer",getInitialState:function(){return{value:""}},_onChange:function(t){this.setState({value:t.target.value})},_onKeyPress:function(t){t.which===n&&this._addItem()},_addItem:function(){t.createTodo(this.state.value),this.setState({value:""})},render:function(){return e.createElement("footer",{className:"footer"},e.createElement("div",{className:"textField"},e.createElement("input",{type:"text",placeholder:"Add new todo",value:this.state.value,onChange:this._onChange,onKeyPress:this._onKeyPress})))}})}),define("LoginForm",["react","LoginStore"],function(e,t){var n=13;return e.createClass({displayName:"LoginForm",getInitialState:function(){return{username:"",password:"",checked:!0,loginError:!1,passwordError:!1}},componentDidMount:function(){t.addLoginListener(this._login)},componentWillUnmount:function(){t.removeLoginListener(this._login)},_onPasswordChange:function(t){this.setState({password:t.target.value})},_onUsernameChange:function(t){this.setState({username:t.target.value})},_onCheckChange:function(){this.setState({checked:!this.state.checked})},_onClick:function(){this.state.username===""?this.setState({loginError:!0}):this.setState({loginError:!1}),this.state.password===""?this.setState({passwordError:!0}):this.setState({passwordError:!1}),this.state.username!==""&&this.state.password!==""&&t.login(this.state.username,this.state.password,this.state.checked)},_onKeyPress:function(t){t.which===n&&this._onClick()},_login:function(){var n=t.getLoginStatus();switch(n){case"Incorrect username":this.setState({loginError:!0});break;case"Incorrect password":this.setState({passwordError:!0});break;default:}},_setLoginErrorClass:function(){return this.state.loginError?"loginError showError":"loginError"},_setPasswordErrorClass:function(){return this.state.passwordError?"passwordError showError":"loginError"},render:function(){return e.createElement("section",{className:"loginForm"},e.createElement("header",{className:"loginFormHeader"},e.createElement("h2",null,"Login")),e.createElement("div",{className:"login"},e.createElement("input",{className:"inputText",id:"login",type:"text",placeholder:"Login",value:this.state.username,onChange:this._onUsernameChange,onKeyPress:this._onKeyPress}),e.createElement("label",{htmlFor:"login",className:this._setLoginErrorClass()},"Incorrect login")),e.createElement("div",{className:"password"},e.createElement("input",{className:"inputText",id:"password",type:"password",placeholder:"Password",value:this.state.password,onChange:this._onPasswordChange,onKeyPress:this._onKeyPress}),e.createElement("label",{htmlFor:"password",className:this._setPasswordErrorClass()},"Incorrect password")),e.createElement("footer",{className:"loginFormFooter"},e.createElement("span",{className:"staySigned"},e.createElement("input",{id:"staySigned",type:"checkbox",checked:this.state.checked,onChange:this._onCheckChange}),e.createElement("label",{htmlFor:"staySigned"},"Stay signed in")),e.createElement("span",{className:"submitLoginButton",tabIndex:"0",onClick:this._onClick,onKeyPress:this._onKeyPress},"SIGN IN")))}})}),define("App",["react","Header","Content","Footer","LoginForm","LoginStore"],function(e,t,n,r,i,s){return e.createClass({displayName:"App",getInitialState:function(){return{isLogged:!1}},componentDidMount:function(){s.addLoginListener(this._toggleState)},componentWillUnmount:function(){s.removeLoginListener(this._toggleState)},_toggleState:function(){s.getLoginStatus()==="Login successful"?this.setState({isLogged:!0}):this.setState({isLogged:!1})},render:function(){return this.state.isLogged?e.createElement("section",{className:"page"},e.createElement(t,null),e.createElement(n,null),e.createElement(r,null)):e.createElement("section",{className:"page"},e.createElement(i,null))}})}),require.config({paths:{react:"react.min",reactDOM:"react-dom.min",flux:"Flux.min",eventEmitter:"EventEmitter.min",App:"components/appComponent",Header:"components/header",Nav:"components/nav",NavItem:"components/navItem",Content:"components/content",Item:"components/item",Footer:"components/footerPanel",ContentEditable:"components/contentEditable",LoginForm:"components/loginForm",Dispatcher:"dispatcher/dispatcher",Actions:"actions/actions",Store:"stores/store",LoginStore:"stores/loginStore",Constants:"constants/constants",queries:"queries"}}),require(["reactDOM","react","App","LoginStore"],function(e,t,n,r){r.initializeFromSession(),e.render(t.createElement(n,null),document.getElementById("main"))}),define("app",function(){});